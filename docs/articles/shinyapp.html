<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to use the causaloptim Shiny app to analyze graphs • causaloptim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to use the causaloptim Shiny app to analyze graphs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">causaloptim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example-code.html">Code from examples in manuscript</a></li>
    <li><a class="dropdown-item" href="../articles/shinyapp.html">How to use the causaloptim Shiny app to analyze graphs</a></li>
    <li><a class="dropdown-item" href="../articles/vertexenum-speed.html">Improving the speed of computing causal bounds</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sachsmc/causaloptim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to use the causaloptim Shiny app to analyze graphs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/causaloptim/blob/HEAD/vignettes/shinyapp.Rmd" class="external-link"><code>vignettes/shinyapp.Rmd</code></a></small>
      <div class="d-none name"><code>shinyapp.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/causaloptim/">causaloptim</a></span><span class="op">)</span></span></code></pre></div>
<p>Run the Shiny application like so. The result is assigned to an
objected called <code>results</code> so that you can save the results
that are produced in the web interface.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/specify_graph.html">specify_graph</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>A new window in your system’s default web browser is opened with the
following interface:</p>
<div class="float">
<img src="screen1.png" alt="Startup"><div class="figcaption">Startup</div>
</div>
<p>The instructions at the top provide details on how to specify the
graph. The graph is divided into a left side and a right side. There is
no confounding allowed between the left and right sides. All variables
on the right side are confounded. Connections between the left and right
sides must originate from the left. I.e, no connections from the right
to left are allowed. On the left side, arbitrary connections are allowed
and the model assumes that all nodes are observed and connected. On the
right side, unmeasured variables are allowed, and the procedure assumes
unmeasured confounding between all nodes. These restrictions ensure that
the problem can be solved analytically using linear optimization.</p>
<p>In the main window below the text, Shift+click to add nodes. When a
node is added, you are prompted to give it a name. Make sure that you
use a valid R variable name, but without underscores. This means it
cannot start with a number, and cannot contain spaces, underscores or
special characters. Single capital letters are good choices, possibly
with trailing numbers.</p>
<div class="float">
<img src="screen2.png" alt="Naming nodes"><div class="figcaption">Naming nodes</div>
</div>
<p>Click on an existing node to select it, and shift+click on a node to
change the name. Shift+drag to connect nodes. Remember than no edges may
go from the right side to the left side. Click a node to select and then
press ‘u’ to mark it as unobserved/latent. Select a node and press a
digit to set that number of possible categorical values (all variables
default to binary), or press ‘c’ and enter a number into the prompt.
Click to select nodes/edges and press ‘d’ to remove. If there are
problems selecting nodes, try restarting your browser.</p>
<div class="float">
<img src="screen3.png" alt="Connections"><div class="figcaption">Connections</div>
</div>
<p>Once we have our graph specified, we can optionally make some
annotations. You may specify the outcome of interest, and the exposure
of interest. Select the outcome node and press ‘y’ to mark it as the
outcome of interest, and then select the exposure node and press ‘e’ to
mark it as the exposure of interest. The default causal contrast is the
total effect. The exposure will be colored blue, and the outcome colored
red.</p>
<div class="float">
<img src="screen4.png" alt="Final graph"><div class="figcaption">Final graph</div>
</div>
<p>We now have a graph specified that is ready to be analyzed.
Optionally, click an edge and press ‘m’ to enforce monotonicity for that
connection. If you are ready to analyze the object click on the “Press
to analyze the graph button”. The program interprets the graph, converts
it to an <code>igraph</code> object with annotations, and prints the
result from R. Inspect the resulting graph carefully so that you
understand what is being analyzed. Note that if a side contains at least
two variables then a confounder has been automatically added for
them.</p>
<div class="section level2">
<h2 id="specifying-the-causal-effect-of-interest">Specifying the causal effect of interest<a class="anchor" aria-label="anchor" href="#specifying-the-causal-effect-of-interest"></a>
</h2>
<p>The next step is to use the text box to specify the causal effect of
interest. In our current example, we are interested in the causal risk
difference in Y comparing X = 1 to X = 0, i.e., Y(X = 1) - Y(X = 0). The
optimizer will compute bounds for the expected value of this
quantity.</p>
<div class="float">
<img src="screen5.png" alt="Interpreted graph"><div class="figcaption">Interpreted graph</div>
</div>
<p>Use the text box to describe your causal effect of interest. The
effects must be of the form</p>
<pre><code>p{V11(X=a)=a; V12(X=a)=b;...} op1 p{V21(X=b)=a; V22(X=c)=b;...} op2 ...</code></pre>
<p>where <code>Vij</code> are names of variables in the graph,
<code>a, b</code> are corresponding values, and <code>op</code> are
either <code>-</code> or <code>+</code>. You can specify a single
probability statement (i.e., no operator). Note that the probability
statements begin with little p, and use curly braces, and items inside
the probability statements are separated by <code>;</code>. The
variables may be potential outcomes which are denoted by parentheses.
Variables may also be nested inside potential outcomes. Pure
observations such as <code>p{Y = 1}</code> are not allowed if the left
side contains any variables. If the left side contains any variables,
then they mush be ancestors of the intervention set variables (or the
intervention variables themselves). All of the following are valid
effect statements:</p>
<pre><code>p{Y(X = 1) = 1} - p{Y(X = 0) = 1}
p{X(Z = 1) = 1; X(Z = 0) = 0}
p{Y(M(X = 0), X = 1) = 1} - p{Y(M(X = 0), X = 0) = 1}</code></pre>
<p>Back to our example, we specify the effect as</p>
<pre><code>p{Y(X = 1) = 1} - p{Y(X = 0) = 1}</code></pre>
<p>then click the “parse” button to fix the effect.</p>
</div>
<div class="section level2">
<h2 id="specifying-constraints-optional">Specifying constraints (optional)<a class="anchor" aria-label="anchor" href="#specifying-constraints-optional"></a>
</h2>
<p>Once the causal effect of interest has been specified, you may
optionally specify some constraints. Click the button to start the
constraint interface.</p>
<p>Here you can specify potential outcomes to constrain by writing the
potential outcomes, values of their parents, and operators that
determine the constraint (equalities or inequalities). In our example,
we can specify monotonicity of the instrument Z by defining the
constraint X(Z = 1)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≥</mo><annotation encoding="application/x-tex">\geq</annotation></semantics></math>
X(Z = 0):</p>
<pre><code><span><span class="fu">X</span><span class="op">(</span>Z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fu">X</span><span class="op">(</span>Z <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
<p>then click parse.</p>
</div>
<div class="section level2">
<h2 id="computation-of-the-bounds">Computation of the bounds<a class="anchor" aria-label="anchor" href="#computation-of-the-bounds"></a>
</h2>
<p>Once you have inspected the graph, specified the causal effect, and
understand what is being analyzed, press the final button to compute the
bounds.</p>
<p>Note that the computation may take a significant amount of time.</p>
<p>The results are summarized in plain text. The bounds are expressed as
the minimum/maximum of a series of expressions involving the conditional
probabilities of the observed variables. For more details on the method
see <a href="https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2071905" class="external-link">this
paper</a>. The final button allows you to return all of the objects back
to the R environment and store them in <code>results</code>.</p>
<p>The <code>results</code> object contains the graph, the
parameterization and interpretation of the graph in terms of the
variables and parameters, the bounds and log information about the
optimization procedure, and an R function that implements the
bounds:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "graphres"       "obj"            "bounds.obs"     "constraints"   </span></span>
<span><span class="co">#&gt; [5] "effect"         "boundsFunction"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">bounds.obs</span><span class="op">)</span></span>
<span><span class="co">#&gt; lower bound =  </span></span>
<span><span class="co">#&gt; MAX {</span></span>
<span><span class="co">#&gt;   p00_0 - p00_1 - p10_1 - p01_1</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; ----------------------------------------</span></span>
<span><span class="co">#&gt; upper bound =  </span></span>
<span><span class="co">#&gt; MIN {</span></span>
<span><span class="co">#&gt;   1 - p10_1 - p01_0</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A function to compute the bounds for a given set of probabilities is available in the x$bounds_function element.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">boundsFunction</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (p00_0 = NULL, p00_1 = NULL, p10_0 = NULL, p10_1 = NULL, </span></span>
<span><span class="co">#&gt;     p01_0 = NULL, p01_1 = NULL, p11_0 = NULL, p11_1 = NULL) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     lb &lt;- pmax(p00_0 - p00_1 - p10_1 - p01_1)</span></span>
<span><span class="co">#&gt;     ub &lt;- pmin(1 - p10_1 - p01_0)</span></span>
<span><span class="co">#&gt;     if (any(ub &lt; lb)) {</span></span>
<span><span class="co">#&gt;         warning("Invalid bounds! Data probably does not satisfy the assumptions in the DAG!")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     data.frame(lower = lb, upper = ub)</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>The results object can also be used to numerically simulate the
bounds. Try using the <code>simulate_bounds</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_bounds.html">simulate_bounds</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">obj</span>, <span class="va">results</span><span class="op">$</span><span class="va">bounds.obs</span>, nsim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt;     objective bound.lower bound.upper</span></span>
<span><span class="co">#&gt; 1  0.11072239  -0.2765626   0.4145571</span></span>
<span><span class="co">#&gt; 2  0.04677063  -0.3380446   0.4131181</span></span>
<span><span class="co">#&gt; 3 -0.20689850  -0.4887614   0.1605880</span></span>
<span><span class="co">#&gt; 4  0.14317449  -0.2369513   0.3885858</span></span>
<span><span class="co">#&gt; 5  0.02464152  -0.3451034   0.3450640</span></span>
<span><span class="co">#&gt; 6  0.09175714  -0.2020024   0.3795258</span></span></code></pre></div>
<p>We also provide a helper function to print the bounds as latex
equations. Use the <code>latex_bounds</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/latex_bounds.html">latex_bounds</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">bounds.obs</span><span class="op">$</span><span class="va">bounds</span>, <span class="va">results</span><span class="op">$</span><span class="va">obj</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Lower bound</mtext><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> 
 \mbox{Lower bound} =   P(X = 0, Y = 0 | Z = 0) - P(X = 0, Y = 0 | Z = 1) - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 1) 
 </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Upper bound</mtext><mo>=</mo><mn>1</mn><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>Z</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> 
 \mbox{Upper bound} =   1 - P(X = 1, Y = 0 | Z = 1) - P(X = 0, Y = 1 | Z = 0) 
 </annotation></semantics></math></p>
<p>Please sends any bugs or feedback to <a href="mailto:sachsmc@gmail.com" class="email">sachsmc@gmail.com</a> or
file an issue on <a href="https://github.com/sachsmc/causaloptim" class="external-link uri">https://github.com/sachsmc/causaloptim</a> .</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael C Sachs, Erin E Gabriel, Arvid Sjölander, Gustav Jonzon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
