<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Improving the speed of computing causal bounds â€¢ causaloptim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Improving the speed of computing causal bounds">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">causaloptim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example-code.html">Code from examples in manuscript</a></li>
    <li><a class="dropdown-item" href="../articles/shinyapp.html">How to use the causaloptim Shiny app to analyze graphs</a></li>
    <li><a class="dropdown-item" href="../articles/vertexenum-speed.html">Improving the speed of computing causal bounds</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sachsmc/causaloptim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Improving the speed of computing causal bounds</h1>
                        <h4 data-toc-skip class="author"><span class="citation">@gjo11</span></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sachsmc/causaloptim/blob/HEAD/vignettes/vertexenum-speed.Rmd" class="external-link"><code>vignettes/vertexenum-speed.Rmd</code></a></small>
      <div class="d-none name"><code>vertexenum-speed.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/causaloptim/">causaloptim</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: igraph</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'igraph'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     decompose, spectrum</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     union</span></span></code></pre></div>
<div class="section level2">
<h2 id="what-is-causaloptim">What is <code>causaloptim</code>?<a class="anchor" aria-label="anchor" href="#what-is-causaloptim"></a>
</h2>
<p>In summary, <code>causaloptim</code> computes <em>symbolic tight
bounds</em> on causal effects. Suppose we have a causal graph
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
in which we want to estimate an effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ACE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}(X\rightarrow Y)</annotation></semantics></math>.
If there is unmeasured confounding of this effect, then it cannot be
determined. However, we can still try to find good bounds on it!</p>
<p>Letâ€™s pretend for a while that the confounding was in fact measured,
so we have an estimate of its distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>.
Then, given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>,
the effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">ACE</mtext><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}_{q}(X\rightarrow Y)</annotation></semantics></math>
is identifiable. Now, even though we donâ€™t actually know
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>,
we surely know <em>something</em> about it; it needs to be consistent
with the structure of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>,
so it satisfies some constraint, say
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>âˆˆ</mo><mi>ğ’œ</mi></mrow><annotation encoding="application/x-tex">q\in\mathcal{A}</annotation></semantics></math>.
With no further assumptions,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">ACE</mtext><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}_{q}(X\rightarrow Y)</annotation></semantics></math>
is valid w.r.t.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
if and only if we have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>âˆˆ</mo><mi>ğ’œ</mi></mrow><annotation encoding="application/x-tex">q\in\mathcal{A}</annotation></semantics></math>,
so finding tight bounds on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ACE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}(X\rightarrow Y)</annotation></semantics></math>
becomes a constrained optimization problem; simply find the extrema of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mtext mathvariant="normal">ACE</mtext><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><mi>q</mi><mo>âˆˆ</mo><mi>ğ’œ</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\text{ACE}_{q}(X\rightarrow Y):q\in\mathcal{A}\}</annotation></semantics></math>.</p>
<p>For a given estimate of the distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
of our <em>measured</em> variables, we could try a large number of
simulations and numerically approximate the bounds, but can we actually
solve the problem analytically to get closed form expressions of the
bounds in terms of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>?
For a certain class of problems, it turns out we can! This is precisely
what <code>causaloptim</code> does, and this post will highlight some of
its inner workings and recent efficiency improvements. For a tutorial on
how to get started using <code>causaloptim</code>, have a look at <a href="https://sachsmc.github.io/causaloptim/articles/shinyapp.html">this
post</a>.</p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Back in 1995, [Balke &amp; Pearl]<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://ftp.cs.ucla.edu/pub/stat_ser/R213-B.pdf" class="external-link uri"&gt;https://ftp.cs.ucla.edu/pub/stat_ser/R213-B.pdf&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> showed how to do this in a classic example
of an experiment with potential non-compliance. More on that shortly,
but in summary they showed how to translate their causal problem into a
linear programming one and leverage tools from linear optimization to
compute the bounds. Balke even wrote a command line program in C++ that
computes them, given such a linear program (LP) as input. His program
has been used successfully by researchers in causal inference since
then, but has had a few issues preventing it from wider adoption among
applied researchers.</p>
<p><code>causaloptim</code> was written to solve these problems. It can
handle the generalized class of problems defined in [Sachs &amp; Jonzon
&amp; Gabriel &amp; SjÃ¶lander]<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2071905" class="external-link uri"&gt;https://www.tandfonline.com/doi/full/10.1080/10618600.2022.2071905&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>. It removes the burden of translating the
causal problem into an LP and has an intuitive graphical user interface
that guides the user through specifying their DAG and causal query. It
has until version <code>0.7.1</code> used Balkeâ€™s code for the
optimization. However, for non-trivial instances of the generalized
class that <code>causaloptim</code> handles, the original optimization
algorithm has not been up to the task.</p>
</div>
<div class="section level2">
<h2 id="efficiency-matters">Efficiency matters!<a class="anchor" aria-label="anchor" href="#efficiency-matters"></a>
</h2>
<p>Letâ€™s time the following simple enough looking multiple instrument
problem.</p>
<div class="figure" style="text-align: center">
<img src="TwoIVs.png" alt="Benchmark Example. Multiple Instruments." width="40%"><p class="caption">
Benchmark Example. Multiple Instruments.
</p>
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/causaloptim/">causaloptim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_literal.html" class="external-link">graph_from_literal</a></span><span class="op">(</span><span class="va">Z1</span> <span class="op">-</span><span class="op">+</span> <span class="va">X</span>, <span class="va">Z2</span> <span class="op">-</span><span class="op">+</span> <span class="va">X</span>, <span class="va">Z2</span> <span class="op">-</span><span class="op">+</span> <span class="va">Z1</span>, <span class="va">Ul</span> <span class="op">-</span><span class="op">+</span> <span class="va">Z1</span>, <span class="va">Ul</span> <span class="op">-</span><span class="op">+</span> <span class="va">Z2</span>, <span class="va">X</span> <span class="op">-</span><span class="op">+</span> <span class="va">Y</span>, <span class="va">Ur</span> <span class="op">-</span><span class="op">+</span> <span class="va">X</span>, <span class="va">Ur</span> <span class="op">-</span><span class="op">+</span> <span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">leftside</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">latent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">nvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">rlconnect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">edge.monotone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_graph.html">analyze_graph</a></span><span class="op">(</span><span class="va">b</span>, constraints <span class="op">=</span> <span class="cn">NULL</span>, effectt <span class="op">=</span> <span class="st">"p{Y(X = 1) = 1} - p{Y(X = 0) = 1}"</span><span class="op">)</span></span></code></pre></div>
<p>Using <code>causaloptim</code> version <code>0.7.1</code> to bound
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ACE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}(X\rightarrow Y)</annotation></semantics></math>
we got (with a 3.3 GHz Quad-Core Intel Core i5; your mileage may
vary)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">oldbnds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_effect_2.html">optimize_effect</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     user  system  elapsed </span></span>
<span><span class="co">#&gt; 31093.57   47.02 61368.22</span></span></code></pre></div>
<p>Note the times (in seconds)! ğŸ˜± Our CPU spent almost
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>9</mn><annotation encoding="application/x-tex">9</annotation></semantics></math>
hours working on this! ğŸ¤– And we spent more than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>17</mn><annotation encoding="application/x-tex">17</annotation></semantics></math>
hours waiting! ğŸ˜´ Correctness is not enough; having to wait until the
next day is a bad user experience. Using <code>causaloptim</code>
version <code>0.8.0</code> however, we get</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">newbnds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_effect_2.html">optimize_effect_2</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  user  system  elapsed </span></span>
<span><span class="co">#&gt; 0.139   0.001    0.140</span></span></code></pre></div>
<p>Now this is acceptable! ğŸ˜Š Of course, we need to verify that the
results are the same. It is difficult to see upon visual inspection that
they are the same, because the vertices are returned in a different
order (and there are lots of them). Instead we can randomly generate
some probability distributions that satisfy the graph, and compute the
bounds and compare the results. First, we create the R functions that
compute the bounds:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eval_newbnds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpret_bounds.html">interpret_bounds</a></span><span class="op">(</span><span class="va">newbnds</span><span class="op">$</span><span class="va">bounds</span>, <span class="va">obj</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="va">eval_oldbnds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interpret_bounds.html">interpret_bounds</a></span><span class="op">(</span><span class="va">oldbnds</span><span class="op">$</span><span class="va">bounds</span>, <span class="va">obj</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span></code></pre></div>
<p>Then, we create a distribution by first randomly generating the
counterfactual probabilities, and then calculating the observable
probabilities by using the constraints implied by the DAG (which live in
the <code>constraints</code> element of <code>obj</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim.qs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">variables</span><span class="op">)</span>, <span class="fl">.05</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim.qs</span> <span class="op">&lt;-</span> <span class="va">sim.qs</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sim.qs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim.qs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">variables</span></span>
<span></span>
<span><span class="va">inenv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sim.qs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim.qs</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">sim.qs</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">inenv</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">constraints</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" = "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">" = "</span>, <span class="va">x1</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">x0</span><span class="op">)</span>, envir <span class="op">=</span> <span class="va">inenv</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">parameters</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span>, envir <span class="op">=</span> <span class="va">inenv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">parameters</span></span></code></pre></div>
<p>Then we pass the probabilities to the bounds functions and
compare:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">eval_newbnds</span>, <span class="va">params</span><span class="op">)</span> </span>
<span><span class="co">#&gt;           lower       upper</span></span>
<span><span class="co">#&gt; q0_0 -0.3148649 -0.08804175</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">eval_oldbnds</span>, <span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt;           lower       upper</span></span>
<span><span class="co">#&gt; q0_0 -0.3148649 -0.08804175</span></span></code></pre></div>
<p>Success!</p>
<p>This improvement was achieved by modernizing a key back-end
optimization algorithm and implementation. To see how it fits into the
bigger picture, letâ€™s first see how <code>causaloptim</code> sets up the
optimization problem.</p>
</div>
<div class="section level2">
<h2 id="how-does-causaloptim-work">How does <code>causaloptim</code> work?<a class="anchor" aria-label="anchor" href="#how-does-causaloptim-work"></a>
</h2>
<p>Given a DAG
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>,
causally relating a set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ’±</mi><annotation encoding="application/x-tex">\mathcal{V}</annotation></semantics></math>
of measured binary variables, suppose we can bipart
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ’±</mi><annotation encoding="application/x-tex">\mathcal{V}</annotation></semantics></math>
so that all association between the two parts is causal and directed
from one part (which we call
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>â„’</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation></semantics></math>)
to the other (called
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>â„›</mi><annotation encoding="application/x-tex">\mathcal{R}</annotation></semantics></math>),
and we want to determine the effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ACE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}(X\rightarrow Y)</annotation></semantics></math>
of some variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on a variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>âˆˆ</mo><mi>â„›</mi></mrow><annotation encoding="application/x-tex">Y\in\mathcal{R}</annotation></semantics></math>.
As a guiding example, letâ€™s follow along the original one given by Balke
&amp; Pearl.</p>
<div class="figure" style="text-align: center">
<img src="User_Input_DAG.png" alt="Original Example: User Input DAG $D$." width="40%"><p class="caption">
Original Example: User Input DAG
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>.
</p>
</div>
<p>Since we assume nothing apart from the macro-structure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>â„’</mi><mo>â†’</mo><mi>â„›</mi><mo>âˆ‹</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">\mathcal{L}\rightarrow\mathcal{R}\ni Y</annotation></semantics></math>,
we must augment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>
with a â€œworst caseâ€ scenario of confounding among <em>each</em> variable
<em>within</em> the parts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>â„’</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>â„›</mi><annotation encoding="application/x-tex">\mathcal{R}</annotation></semantics></math>
to get a causal graph
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>.<br>
The specific causal graph below can be interpreted as an experiment with
potential non-compliance. We have three binary measured variables;
treatment <em>assigned</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
treatment <em>taken</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
We want to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ACE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}(X\rightarrow Y)</annotation></semantics></math>,
which is confounded by the unmeasured
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>
and has a single instrument
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.</p>
<div class="figure" style="text-align: center">
<img src="Causal_Graph.png" alt="Original Example: Causal Graph $G$." width="40%"><p class="caption">
Original Example: Causal Graph
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>.
</p>
</div>
<div class="section level3">
<h3 id="response-function-variables">Response Function Variables<a class="anchor" aria-label="anchor" href="#response-function-variables"></a>
</h3>
<p>This yields a functional causal model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>F</mi><mi>V</mi></msub><mo>:</mo><mi>p</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>Ã—</mo><msub><mi>U</mi><mi>V</mi></msub><mo>â†’</mo><mi>V</mi><mo>âˆ£</mo><mi>V</mi><mo>âˆˆ</mo><mi>ğ’±</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{F_V:pa(V)\times U_V\to V\mid V\in\mathcal{V}\}</annotation></semantics></math>,
although not in a computationally convenient form. However, by the
assumption of finite-valued measured variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>âˆˆ</mo><mi>ğ’±</mi></mrow><annotation encoding="application/x-tex">V\in\mathcal{V}</annotation></semantics></math>,
we can in fact partition the ranges of the unmeasured ones
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>V</mi></msub><mo>âˆˆ</mo><mi>ğ’°</mi></mrow><annotation encoding="application/x-tex">U_V\in\mathcal{U}</annotation></semantics></math>
into finitely many sets; they simply enumerate the finitely many
distinct functions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â†’</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">pa(V)\to V</annotation></semantics></math>
for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>âˆˆ</mo><mi>ğ’±</mi></mrow><annotation encoding="application/x-tex">V\in\mathcal{V}</annotation></semantics></math>.
We call such a canonical partition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>V</mi></msub><annotation encoding="application/x-tex">R_V</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mi>V</mi></msub><annotation encoding="application/x-tex">U_V</annotation></semantics></math>
the <em>response function variable</em> of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>V</mi><annotation encoding="application/x-tex">V</annotation></semantics></math>.</p>
<div class="figure" style="text-align: center">
<img src="Canonical_Partitions.png" alt="Original Example: Response Function Variables." width="30%"><p class="caption">
Original Example: Response Function Variables.
</p>
</div>
<p>(The dashed line signifies <span class="math inline">$R_X\not\!\perp\!\!\!\perp R_Y$</span>.) In the
context of our specific example, where
e.g.Â <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
has a single parent only so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>X</mi></msub><annotation encoding="application/x-tex">R_X</annotation></semantics></math>
takes exactly
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4</mn><annotation encoding="application/x-tex">4</annotation></semantics></math>
distinct values, say
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{0,1,2,3\}</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ€</mo><mi>z</mi><mo>âˆˆ</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\forall z\in\{0,1\}</annotation></semantics></math>,
we have</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">ğ‘ğğ¬ğ©ğ¨ğ§ğ¬ğ ğğšğ­ğ­ğğ«ğ§</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">ğ…ğ®ğ§ğœğ­ğ¢ğ¨ğ§</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">ğˆğ§ğ­ğğ«ğ©ğ«ğğ­ğšğ­ğ¢ğ¨ğ§</mtext></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>r</mi><mo>=</mo><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>f</mi><mi>X</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mrow><mtext mathvariant="normal">never takes </mtext><mspace width="0.333em"></mspace></mrow><mi>X</mi><mrow><mtext mathvariant="normal">, regardless of </mtext><mspace width="0.333em"></mspace></mrow><mi>Z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>r</mi><mo>=</mo><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>f</mi><mi>X</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>z</mi></mtd><mtd columnalign="center" style="text-align: center"><mrow><mtext mathvariant="normal">full compliance with assignment </mtext><mspace width="0.333em"></mspace></mrow><mi>Z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>r</mi><mo>=</mo><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>f</mi><mi>X</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mi>z</mi></mtd><mtd columnalign="center" style="text-align: center"><mrow><mtext mathvariant="normal">total defiance of assignment </mtext><mspace width="0.333em"></mspace></mrow><mi>Z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>r</mi><mo>=</mo><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>f</mi><mi>X</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mrow><mtext mathvariant="normal">always takes </mtext><mspace width="0.333em"></mspace></mrow><mi>X</mi><mrow><mtext mathvariant="normal">, regardless of </mtext><mspace width="0.333em"></mspace></mrow><mi>Z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{matrix}
\textbf{Response Pattern}&amp;\textbf{Function}&amp;\textbf{Interpretation}\\
r=0&amp;f_X(z,0)=0&amp;\text{never takes $X$, regardless of $Z$}\\
r=1&amp;f_X(z,1)=z&amp;\text{full compliance with assignment $Z$}\\
r=2&amp;f_X(z,2)=1-z&amp;\text{total defiance of assignment $Z$}\\
r=3&amp;f_X(z,3)=1&amp;\text{always takes $X$, regardless of $Z$}\\
\end{matrix}</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="parameters-and-their-relationships">Parameters and their Relationships<a class="anchor" aria-label="anchor" href="#parameters-and-their-relationships"></a>
</h3>
<p>We can observe the outcomes of the variables in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ’±</mi><annotation encoding="application/x-tex">\mathcal{V}</annotation></semantics></math>,
so we can estimate their joint distribution, but in fact we will only
need their conditional distribution given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>â„’</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation></semantics></math>,
so letâ€™s establish some notation for this. For our specific example we
define
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>;</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><mo>:=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo stretchy="false" form="prefix">|</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mo>âˆ€</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>âˆˆ</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">p_{(y,x;z)}:=P(y,x|z),\quad\forall x,y,x\in\{0,1\}</annotation></semantics></math>
Although unknown, we need notation for the distribution of the response
function variables as well. Our specific example requires only
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></msub><mo>:=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mo>âˆ€</mo><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo>âˆˆ</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>3</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">q_{(r_X,r_Y)}:=P(r_X,r_Y),\quad\forall r_X,r_Y\in\{0,1,2,3\}</annotation></semantics></math>
By the Markovian property, our example yields
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo>;</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><mo>=</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub></mrow></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="false" form="prefix">|</mo><mi>z</mi><mo>,</mo><msub><mi>r</mi><mi>X</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>q</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">p_{(y,x;z)}=\sum_{r_X,r_Y}P(y|x,r_Y)P(x|z,r_X)q_{(r_X,r_Y)}</annotation></semantics></math>
Note that all coefficients are deterministic binary, since
e.g.Â <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">, if </mtext><mspace width="0.333em"></mspace></mrow><mi>y</mi><mo>=</mo><msub><mi>f</mi><mi>Y</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">, otherwise</mtext></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">P(y|x,r_Y)=\begin{cases}1&amp;\text{, if }y=f_Y(x,r_Y)\\0&amp;\text{, otherwise}\end{cases}</annotation></semantics></math>,
and by recursion the same applies to more complex examples. Thus, in our
particular example, we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mi>R</mi><mi>q</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> for some matrix </mtext><mspace width="0.333em"></mspace></mrow><mi>R</mi><mo>âˆˆ</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false" form="postfix">}</mo><mrow><mn>8</mn><mo>Ã—</mo><mn>16</mn></mrow></msup></mrow><annotation encoding="application/x-tex">p=Rq\text{ for some matrix }R\in\{0,1\}^{8\times16}</annotation></semantics></math>
Further, we can express potential outcomes of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
under intervention on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
in terms of the parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
by the adjustment formula;
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>d</mi><mi>o</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mrow><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub></mrow></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>x</mi><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>q</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>X</mi></msub><mo>,</mo><msub><mi>r</mi><mi>Y</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">P(y|do(x))=\sum_{r_X,r_Y}P(y|x,r_Y)q_{(r_X,r_Y)}</annotation></semantics></math>
Hence, we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mtext mathvariant="normal">ACE</mtext><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>d</mi><mi>o</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ’</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>d</mi><mi>o</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>c</mi><mi>T</mi></msup><mi>q</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> for some vector </mtext><mspace width="0.333em"></mspace></mrow><mi>c</mi><mo>âˆˆ</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi>âˆ’</mi><mn>1</mn><msup><mo stretchy="false" form="postfix">}</mo><mn>16</mn></msup></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\text{ACE}_q(X\rightarrow Y)
&amp;=P(Y=1|do(X=1))-P(Y=1|do(X=0))\\
&amp;=c^Tq\text{ for some vector }c\in\{0,1,-1\}^{16}
\end{align*}</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="linear-programming">Linear Programming<a class="anchor" aria-label="anchor" href="#linear-programming"></a>
</h3>
<p>Now we have our constraints on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
as well as our effect of interest in terms of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
and we are ready to optimize! By adding the probabilistic constraints on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
we have arrived at e.g.Â the following LP giving a tight lower bound on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">ACE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{ACE}(X\rightarrow Y)</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><mo>min</mo></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>c</mi><mi>T</mi></msup><mi>q</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>s</mi><mi>t</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>Î£</mi><mi>q</mi><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>&amp;</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>R</mi><mi>q</mi><mo>=</mo><mi>p</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>&amp;</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>q</mi><mo>â‰¥</mo><mn>0</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{matrix}
\min&amp;c^Tq\\
st&amp;\Sigma q=1\\
\&amp;&amp;Rq=p\\
\&amp;&amp;q\geq0
\end{matrix}</annotation></semantics></math> By <em>the Strong Duality
Theorem</em><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Dual_linear_program#Strong_duality" class="external-link uri"&gt;https://en.wikipedia.org/wiki/Dual_linear_program#Strong_duality&lt;/a&gt;&lt;/p&gt;'><sup>3</sup></a> of convex optimization, the optimal value
of this primal problem equals that of its dual. Furthermore, its
constraint space is a convex polytope and by <em>the Fundamental Theorem
of Linear Programming</em><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Fundamental_theorem_of_linear_programming" class="external-link uri"&gt;https://en.wikipedia.org/wiki/Fundamental_theorem_of_linear_programming&lt;/a&gt;&lt;/p&gt;'><sup>4</sup></a>, this optimum is attained at one of its
vertices. Consequently, we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><munder><mo>min</mo><mi>q</mi></munder><mi>A</mi><mi>C</mi><msub><mi>E</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>min</mo><mo stretchy="false" form="prefix">{</mo><msup><mi>c</mi><mi>T</mi></msup><mi>q</mi><mo>âˆ£</mo><mi>q</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mn>16</mn></msup><mo>,</mo><mi>q</mi><mo>â‰¥</mo><msub><mn>0</mn><mrow><mn>16</mn><mo>Ã—</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mn>1</mn><mrow><mn>1</mn><mo>Ã—</mo><mn>16</mn></mrow></msub><mi>q</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>R</mi><mi>q</mi><mo>=</mo><mi>p</mi><mo stretchy="false" form="postfix">}</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>max</mo><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>p</mi><mi>T</mi></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi><mo>âˆ£</mo><mi>y</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mn>9</mn></msup><mo>,</mo><mi>y</mi><mo>â‰¥</mo><msub><mn>0</mn><mrow><mn>9</mn><mo>Ã—</mo><mn>1</mn></mrow></msub><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mn>1</mn><mrow><mn>16</mn><mo>Ã—</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>R</mi><mi>T</mi></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‰¤</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>max</mo><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>p</mi><mi>T</mi></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mo>âˆ£</mo><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> is a vertex of </mtext><mspace width="0.333em"></mspace></mrow><mo stretchy="false" form="prefix">{</mo><mi>y</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mn>9</mn></msup><mo>âˆ£</mo><mi>y</mi><mo>â‰¥</mo><msub><mn>0</mn><mrow><mn>9</mn><mo>Ã—</mo><mn>1</mn></mrow></msub><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mn>1</mn><mrow><mn>16</mn><mo>Ã—</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>R</mi><mi>T</mi></msup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‰¤</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo><mo stretchy="false" form="postfix">}</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\min_q ACE_q(X\rightarrow Y)
&amp;=\min\{c^Tq\mid q\in\mathbb{R}^{16},q\geq0_{16\times1},1_{1\times16} q=1,Rq=p\}\\
&amp;=\max\{\begin{pmatrix}1&amp;p^T\end{pmatrix}y\mid y\in\mathbb{R}^{9},y\geq0_{9\times1},\begin{pmatrix}1_{16\times1}&amp;R^T\end{pmatrix}\leq c\}\\
&amp;=\max\{\begin{pmatrix}1&amp;p^T\end{pmatrix}\bar{y}\mid\bar{y}\text{ is a vertex of }\{y\in\mathbb{R}^{9}\mid y\geq0_{9\times1},\begin{pmatrix}1_{16\times1}&amp;R^T\end{pmatrix}\leq c\}\}
\end{align*}</annotation></semantics></math> Since we allow the user to
provide additional linear inequality constraints (e.g.Â it may be quite
reasonable to assume the proportion of â€œdefiersâ€ in the study population
of our example to be quite low), the actual primal and dual LPâ€™s look
slightly more complicated, but this small example still captures the
essentials.<br>
In general, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>e</mi></msub><mo>:=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mn>1</mn><mrow><mi>n</mi><mo>Ã—</mo><mn>1</mn></mrow><mi>T</mi></msubsup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>R</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">A_e:=\begin{pmatrix}1_{n\times1}^T\\R\end{pmatrix}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>e</mi></msub><mo>:=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>p</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b_e:=\begin{pmatrix}1\\p\end{pmatrix}</annotation></semantics></math>
and user provided matrix inequality
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mo>â„“</mo></msub><mi>q</mi><mo>â‰¤</mo><msub><mi>b</mi><mo>â„“</mo></msub></mrow><annotation encoding="application/x-tex">A_{\ell}q\leq b_{\ell}</annotation></semantics></math>,
we have
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><munder><mo>min</mo><mi>q</mi></munder><mrow><mo stretchy="true" form="prefix">(</mo><mi>A</mi><mi>C</mi><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>A</mi><mo>â†’</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><msup><mi>c</mi><mi>T</mi></msup><mi>q</mi><mo>âˆ£</mo><mi>q</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mi>n</mi></msup><mo>,</mo><msub><mi>A</mi><mo>â„“</mo></msub><mi>q</mi><mo>â‰¤</mo><msub><mi>b</mi><mo>â„“</mo></msub><mo>,</mo><msub><mi>A</mi><mi>e</mi></msub><mi>q</mi><mo>=</mo><msub><mi>b</mi><mi>e</mi></msub><mo>,</mo><mi>q</mi><mo>â‰¥</mo><msub><mn>0</mn><mrow><mi>n</mi><mo>Ã—</mo><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>max</mo><mo stretchy="false" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>b</mi><mo>â„“</mo><mi>T</mi></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>b</mi><mi>e</mi><mi>T</mi></msubsup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi><mo>âˆ£</mo><mi>y</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mrow><msub><mi>m</mi><mo>â„“</mo></msub><mo>+</mo><msub><mi>m</mi><mi>e</mi></msub></mrow></msup><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>A</mi><mo>â„“</mo><mi>T</mi></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>A</mi><mi>e</mi><mi>T</mi></msubsup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi><mo>â‰¤</mo><mi>c</mi><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>I</mi><mrow><msub><mi>m</mi><mi>l</mi></msub><mo>Ã—</mo><msub><mi>m</mi><mi>l</mi></msub></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mn>0</mn><mrow><msub><mi>m</mi><mi>l</mi></msub><mo>Ã—</mo><msub><mi>m</mi><mi>e</mi></msub></mrow></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi><mo>â‰¤</mo><msub><mn>0</mn><mrow><msub><mi>m</mi><mi>l</mi></msub><mo>Ã—</mo><mn>1</mn></mrow></msub><mo stretchy="false" form="postfix">}</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>b</mi><mo>â„“</mo><mi>T</mi></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>b</mi><mi>e</mi><mi>T</mi></msubsup></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mo>âˆ£</mo><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> is a vertex of </mtext><mspace width="0.333em"></mspace></mrow><mo stretchy="false" form="prefix">{</mo><mi>y</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mrow><msub><mi>m</mi><mo>â„“</mo></msub><mo>+</mo><msub><mi>m</mi><mi>e</mi></msub></mrow></msup><mo>âˆ£</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>A</mi><mo>â„“</mo><mi>T</mi></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>A</mi><mi>e</mi><mi>T</mi></msubsup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>I</mi><mrow><msub><mi>m</mi><mi>l</mi></msub><mo>Ã—</mo><msub><mi>m</mi><mi>l</mi></msub></mrow></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mn>0</mn><mrow><msub><mi>m</mi><mi>l</mi></msub><mo>Ã—</mo><msub><mi>m</mi><mi>e</mi></msub></mrow></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi><mo>â‰¤</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>c</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mn>0</mn><mrow><msub><mi>m</mi><mi>l</mi></msub><mo>Ã—</mo><mn>1</mn></mrow></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}\min_q(ACE(A\to Y))&amp;=\min(\{c^Tq\mid q\in\mathbb{R}^n,A_{\ell}q\leq b_{\ell},A_eq=b_e,q\geq0_{n\times1}\})\\
&amp;=\max(\{\begin{pmatrix}b_{\ell}^T&amp;b_e^T\end{pmatrix}y\mid y\in\mathbb{R}^{m_{\ell}+m_e},\begin{pmatrix}A_{\ell}^T&amp;A_e^T\end{pmatrix}y\leq c,\begin{pmatrix}I_{m_l\times m_l}&amp;0_{m_l\times m_e}\end{pmatrix}y\leq0_{m_l\times1}\}\\
&amp;=\max(\{\begin{pmatrix}b_{\ell}^T&amp;b_e^T\end{pmatrix}\bar{y}\mid\bar{y}\text{ is a vertex of }\{y\in\mathbb{R}^{m_{\ell}+m_e}\mid\begin{pmatrix}A_{\ell}^T&amp;A_e^T\\I_{m_l\times m_l}&amp;0_{m_l\times m_e}\end{pmatrix}y\leq\begin{pmatrix}c\\0_{m_l\times1}\end{pmatrix}\}\})\end{align*}</annotation></semantics></math>
The coefficient matrix and right hand side vector of the dual polytope
are constructed in the few lines of code below (where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>0</mn></msub><mo>:=</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">c_0:=c</annotation></semantics></math>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A_l</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A_e</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="va">m_l</span>, ncol <span class="op">=</span> <span class="va">m_l</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">m_l</span>, ncol <span class="op">=</span> <span class="va">m_e</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">c0</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">m_l</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">opt</span> <span class="op">==</span> <span class="st">"max"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">a1</span></span>
<span>  <span class="va">b1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">b1</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vertex-enumeration">Vertex Enumeration<a class="anchor" aria-label="anchor" href="#vertex-enumeration"></a>
</h3>
<p>The last step of vertex enumeration has previously been the major
computational bottleneck in <code>causaloptim</code>. It has now been
replaced by <code>cddlib</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://people.inf.ethz.ch/fukudak/cdd_home/" class="external-link uri"&gt;https://people.inf.ethz.ch/fukudak/cdd_home/&lt;/a&gt;&lt;/p&gt;'><sup>5</sup></a>, which has an implementation of <em>the
Double Description Method</em> (dd). Any convex polytope can be dually
described as either an intersection of half-planes (which is the form we
<em>get</em> our dual constraint space in) or as a minimal set of
vertices of which it is the convex hull (which is the form we
<em>want</em> it in) and the dd algorithm efficiently converts between
these two descriptions. <code>cddlib</code> also uses exact rational
arithmetic, so we donâ€™t have to worry about any numerical instability
issues, e.g.Â Also, it already interfaces with R<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://CRAN.R-project.org/package=rcdd" class="external-link uri"&gt;https://CRAN.R-project.org/package=rcdd&lt;/a&gt;&lt;/p&gt;'><sup>6</sup></a>. The following lines
of code extract the vertices of the dual polytope and store them as rows
of a matrix.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.umn.edu/geyer/rcdd/" class="external-link">rcdd</a></span><span class="op">)</span></span>
<span><span class="va">hrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rcdd/man/makeH.html" class="external-link">makeH</a></span><span class="op">(</span>a1 <span class="op">=</span> <span class="va">a1</span>, b1 <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span><span class="va">vrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rcdd/man/scdd.html" class="external-link">scdd</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">hrep</span><span class="op">)</span></span>
<span><span class="va">matrix_of_vrep</span> <span class="op">&lt;-</span> <span class="va">vrep</span><span class="op">$</span><span class="va">output</span></span>
<span><span class="va">indices_of_vertices</span> <span class="op">&lt;-</span> <span class="va">matrix_of_vrep</span><span class="op">[</span> , <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">matrix_of_vrep</span><span class="op">[</span> , <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span></span>
<span><span class="va">vertices</span> <span class="op">&lt;-</span> <span class="va">matrix_of_vrep</span><span class="op">[</span><span class="va">indices_of_vertices</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></code></pre></div>
<p>The rest is simply a matter of plugging them into the dual objective
function, evaluating the expression and presenting the results!<br>
The first part of this is done by the following line of code, where the
utility function <code>evaluate_objective</code> pretty much does what
you expect it to do (here
<code>(c1_num,p)</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>b</mi><mo>â„“</mo><mi>T</mi></msubsup></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">=(\begin{pmatrix}b_{\ell}^T&amp;1\end{pmatrix},p)</annotation></semantics></math>
separates the dual objective gradient into its numeric and symbolic
parts).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expressions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">vertices</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu">evaluate_objective</span><span class="op">(</span>c1_num <span class="op">=</span> <span class="va">c1_num</span>, p <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>There are still a few places in <code>causaloptim</code> that are
worthwhile to optimize, but with this major one resolved we looking
forward to researchers taking advantage of the generalized class of
problems that it can handle!</p>
<p>Happy bounding!</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael C Sachs, Erin E Gabriel, Arvid SjÃ¶lander, Gustav Jonzon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
